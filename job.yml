apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: kube-bench
spec:
  schedule: "0 23 * * *"
  jobTemplate:
    metadata:
      labels:
        app: kube-bench
    spec:
      template:
        spec:
          hostPID: true
          containers:
          - name: kube-bench
            #image: aquasec/kube-bench:latest
            image: rrey/kube-bench:0.7
            #command: ["kube-bench", "--json", "--logtostderr", "--outputfile", "kube-bench-node.json"]
            env:
             - name: REPORT_FILENAME
               value: kube-bench-node.json
             - name: KUBERNETES_VERSION
               value: "1.14"
             - name: S3_BUCKET_NAME
               value: "test-kube-rre"
             - name: AWS_ACCESS_KEY_ID
               value: AKIAQIXVWUDKBJ2G7K7R
             - name: AWS_SECRET_ACCESS_KEY
               valueFrom:
                 secretKeyRef:
                   name: aws-secret-access-key
                   key: AWS_SECRET_ACCESS_KEY
            volumeMounts:
            - name: var-lib-etcd
              mountPath: /var/lib/etcd
            - name: var-lib-kubelet
              mountPath: /var/lib/kubelet
            - name: etc-systemd
              mountPath: /etc/systemd
            - name: etc-kubernetes
              mountPath: /etc/kubernetes
              # /usr/bin is mounted to access kubectl / kubelet, for auto-detecting the Kubernetes version.
              # You can omit this mount if you specify --version as part of the command.
              #- name: usr-bin
              #  mountPath: /usr/bin
          restartPolicy: Never
          volumes:
          - name: var-lib-etcd
            hostPath:
              path: "/var/lib/etcd"
          - name: var-lib-kubelet
            hostPath:
              path: "/var/lib/kubelet"
          - name: etc-systemd
            hostPath:
              path: "/etc/systemd"
          - name: etc-kubernetes
            hostPath:
              path: "/etc/kubernetes"
          - name: usr-bin
            hostPath:
              path: "/usr/bin"
